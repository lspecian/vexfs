#cloud-config
users:
  - name: vexfs
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFUefWT5WcN45B0Sin78RWnGi9ngRAT0yCNsJ3KRvIxl vexfs-vm-key

# Skip package updates for faster boot
package_update: false
package_upgrade: false

packages:
  - build-essential
  - linux-headers-generic

runcmd:
  # Mount VexFS source quickly
  - mkdir -p /mnt/vexfs_source
  - echo "vexfs_source /mnt/vexfs_source 9p trans=virtio,version=9p2000.L,posix,rw 0 0" >> /etc/fstab
  - mount -a
  
  # Create build directory symlink
  - sudo -u vexfs ln -sf /mnt/vexfs_source /home/vexfs/vexfs_build

final_message: "VexFS development VM is ready! Connect via SSH on port 2222"